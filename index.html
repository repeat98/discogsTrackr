<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trackr</title>
    
    <!-- Favicon / App Icons -->
    <!-- Apple Touch Icon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="img/apple-touch-icon.png"
    />
    <!-- Standard Favicon (ICO) -->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
    <!-- PNG Favicons for Different Sizes -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="img/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="img/favicon-16x16.png"
    />
    <!-- Web App Manifest -->
    <link rel="manifest" href="img/site.webmanifest" />
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Trackr">
    <meta property="og:description" content="Scan discogs sellers and discover what else they have available. Perfect for when you're ordering a record from a specific dealer - check out their other great releases and save on shipping costs.">
    <meta property="og:image" content="img/screen.jpg">
    <meta property="og:url" content="https://repeat98.github.io/discogsTrackr/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Trackr">
    <meta name="twitter:description" content="Track discogs sellers - Track your favorite sellers">
    <meta name="twitter:image" content="img/screen.jpg">
    
    <!-- Google Analytics 4 (GA4) Global Site Tag -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-309VMDXR59"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-309VMDXR59");
    </script>
    <!-- End GA4 -->
    
    <!-- Google Fonts (Figtree) -->
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    
    <!-- YouTube Iframe API -->
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="dark-mode">
    <div class="Desktop">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container MainContainer">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <a class="navbar-brand d-flex align-items-center" href="#" onclick="loadAllSellersData(); return false;">
                        <img
                            src="img/gruuvs-logo.svg"
                            alt="Discogs Trackr Logo"
                            class="me-2"
                            style="height: 24px; width: auto"
                        />
                        TRACKR
                        <span class="powered-by d-none d-md-inline fst-italic fw-light ms-1">
                            Track discogs sellers
                        </span>
                    </a>
                    <div class="d-flex align-items-center">
                        <div class="search-input-wrapper me-2 d-none d-md-block" style="max-width: 260px; position: relative;">
                            <input type="text" id="navSearchInput" class="form-control form-control-sm" placeholder="Search..." style="padding-right: 28px;">
                            <i class="bi bi-search" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); opacity: 0.6;"></i>
                        </div>
                        <!-- Collection and Wantlist icons (only show when logged in) -->
                        <span id="collectionIcon" class="settings-icon" onclick="showUserCollection()" style="display: none;" title="My Collection">
                            <i class="bi bi-collection"></i>
                        </span>
                        <span id="wantlistIcon" class="settings-icon" onclick="showUserWantlist()" style="display: none;" title="My Wantlist">
                            <i class="bi bi-eye"></i>
                        </span>
                        <span class="profile-icon" onclick="openProfile()">
                            <i class="bi bi-person-circle"></i>
                        </span>
                        <span class="settings-icon" onclick="openSettings()">
                            <i class="bi bi-gear"></i>
                        </span>
                        <div class="dark-mode-toggle">
                            <span id="darkModeToggle">
                                <span class="moon-icon"><i class="bi bi-moon"></i></span>
                                <span class="sun-icon"><i class="bi bi-sun"></i></span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Filter form -->
        <div class="filter-form-wrapper" id="filter-wrapper">
            <div class="container MainContainer">
                <form id="filter-form" class="FilterContainer">
                    <div class="filter-group">
                        <label for="genre" class="filter-label">Genre</label>
                        <select id="genre" name="genre" class="filter-select">
                            <option value="">All Genres</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="style" class="filter-label">Style</label>
                        <select id="style" name="style" class="filter-select">
                            <option value="">All Styles</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="artist" class="filter-label">Artist</label>
                        <select id="artist" name="artist" class="filter-select">
                            <option value="">All Artists</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="label" class="filter-label">Label</label>
                        <select id="label" name="label" class="filter-select">
                            <option value="">All Labels</option>
                        </select>
                    </div>
                    <!-- Mobile extra filters toggle button (only visible on mobile) -->
                    <button
                        type="button"
                        id="mobile-filters-toggle"
                        class="btn btn-secondary mobile-toggle-btn"
                    >
                        <i class="bi bi-chevron-down"></i>
                    </button>
                    <!-- Extra filters wrapped (year, rating, count, price) -->
                    <div class="mobile-extra-filters-wrapper">
                        <div class="filter-group">
                            <label for="year_range" class="filter-label">Year range</label>
                            <input type="text" id="year_range" name="year_range" class="filter-input" placeholder="e.g. 2010-2015">
                        </div>
                        <div class="filter-group">
                            <label for="rating_range" class="filter-label">Rating range</label>
                            <input type="text" id="rating_range" name="rating_range" class="filter-input" placeholder="e.g. 3-5">
                        </div>
                        <div class="filter-group">
                            <label for="rating_count_range" class="filter-label">Rating Count</label>
                            <input type="text" id="rating_count_range" name="rating_count_range" class="filter-input" placeholder="e.g. 10-100">
                        </div>
                        <div class="filter-group">
                            <label for="price_range" class="filter-label">Price range</label>
                            <input type="text" id="price_range" name="price_range" class="filter-input" placeholder="e.g. 5-25">
                        </div>
                        <div class="filter-group">
                            <label for="want_range" class="filter-label">Want range</label>
                            <input type="text" id="want_range" name="want_range" class="filter-input" placeholder="e.g. 10-100">
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tracked Sellers -->
        <div class="container MainContainer">
            <div class="sellers-sidebar" id="sellersPanel">
                <div class="sellers-header">
                    <h5 class="mb-0">
                        <span>Tracked Sellers (<span id="sellerCount">0</span>)</span>
                    </h5>
                    <div class="chips" id="selectedChips"></div>
                    <div class="d-flex align-items-center gap-2">
                        <button class="btn btn-sm btn-brand" onclick="openAddSellerModal()">
                            <i class="bi bi-plus-circle"></i> Add Seller
                        </button>
                        <button class="btn btn-sm btn-brand" onclick="updateAllSellers()">
                            <i class="bi bi-arrow-repeat"></i> Update All
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" onclick="toggleSellersPanel()" id="toggleSellersBtn">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>
                </div>
                <ul class="seller-list" id="sellerList">
                    <li class="text-muted text-center py-3">No sellers tracked yet. Add one above!</li>
                </ul>
            </div>
        </div>

        <!-- Main Content container for table and pagination -->
        <div class="container MainContainer" style="position: relative" id="resultsSection">
            <div class="d-flex justify-content-between align-items-center mb-2" style="margin-top: 1rem">
                <div id="results-count" class="fw-semibold"></div>
            </div>

            <div class="table-container">
                <table class="table table-hover table-bordered mb-0">
                    <thead id="table-header"></thead>
                    <tbody id="releases-table-body">
                        <tr><td class="no-results" colspan="15">
                            <p>Add a seller above to start tracking releases</p>
                        </td></tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination-container">
                <ul class="pagination" id="pagination" style="display: none;"></ul>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Profile & Data Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <h6 class="mb-3">Discogs Personal Access Token</h6>
                        <p class="text-muted small mb-2">To access your Collection and Wantlist, enter your Personal Access Token from <a href="https://www.discogs.com/settings/developers" target="_blank">Discogs Developer Settings</a>.</p>
                        
                        <div id="tokenLoginSection" style="display: block;">
                            <input type="text" class="form-control mb-2" id="profileTokenInput" placeholder="Paste your token here">
                            <button type="button" class="btn btn-brand w-100 mb-2" onclick="loginWithTokenFromProfile()">
                                <i class="bi bi-box-arrow-in-right"></i> Login
                            </button>
                        </div>
                        
                        <div id="tokenLoggedInSection" style="display: none;">
                            <div class="alert alert-success mb-2">
                                <i class="bi bi-check-circle"></i> Logged in as <strong id="profileUsername"></strong>
                            </div>
                            <button type="button" class="btn btn-outline-danger w-100" onclick="logoutOAuth()">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </button>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="mb-4">
                        <h6 class="mb-3">Export Data</h6>
                        <p class="text-muted small mb-3">Download all your data including tracked sellers, releases, inventory, and settings as a JSON file.</p>
                        <button type="button" class="btn btn-brand w-100" onclick="exportData()">
                            <i class="bi bi-download"></i> Export All Data
                        </button>
                    </div>
                    
                    <hr>
                    
                    <div>
                        <h6 class="mb-3">Import Data</h6>
                        <p class="text-muted small mb-3">Import data from a previously exported JSON file. This will replace your current data.</p>
                        <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                        <button type="button" class="btn btn-brand w-100" onclick="document.getElementById('importFileInput').click()">
                            <i class="bi bi-upload"></i> Import Data
                        </button>
                        <div class="alert alert-warning small mt-3 mb-0" role="alert">
                            <i class="bi bi-exclamation-triangle"></i> <strong>Warning:</strong> Importing will replace all existing data. Make sure to export your current data first if you want to keep it.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Discogs API Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small">Create an application in the Discogs Developer settings, then copy the Consumer Key and Consumer Secret into the fields below. <a href="https://www.discogs.com/settings/developers" target="_blank" class="brand-link">Open Discogs Developer settings</a>.</p>
                    <div class="mb-3">
                        <label for="consumerKey" class="form-label">Consumer Key</label>
                        <input type="text" class="form-control" id="consumerKey" placeholder="Your consumer key">
                    </div>
                    <div class="mb-3">
                        <label for="consumerSecret" class="form-label">Consumer Secret</label>
                        <input type="text" class="form-control" id="consumerSecret" placeholder="Your consumer secret">
                    </div>
                    <div class="alert alert-warning small mb-0" role="alert">
                        <i class="bi bi-info-circle"></i> <strong>Note:</strong> Discogs limits non-owned inventories to 100 pages (max 10,000 items). Sellers with larger inventories will only show their first 10,000 items. This is a Discogs API restriction.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-brand" onclick="saveSettings()">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Seller Modal -->
    <div class="modal fade" id="addSellerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Discogs Seller</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label for="addSellerInput" class="form-label">Discogs Username</label>
                    <input type="text" class="form-control" id="addSellerInput" placeholder="e.g. vinylseller" onkeypress="if(event.key==='Enter') addSellerFromModal()">
                    <div class="form-text">We will fetch this seller's inventory and keep it cached locally.</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-brand" onclick="addSellerFromModal()">Add Seller</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Seller Options Modal -->
    <div class="modal fade" id="sellerOptionsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sellerOptionsTitle">Seller Options</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small mb-3">
                        Choose which <strong>styles</strong> you want to keep for this seller. By default, all styles are included.
                        Changes affect which releases are shown and kept after the next refresh or scan.
                    </p>
                    <div id="sellerStylesSection" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">Styles for <span id="sellerOptionsName"></span></h6>
                            <div class="btn-group btn-group-sm" role="group" aria-label="Select styles">
                                <button type="button" class="btn btn-outline-secondary" onclick="selectAllSellerStyles(true)">Select All</button>
                                <button type="button" class="btn btn-outline-secondary" onclick="selectAllSellerStyles(false)">Clear</button>
                            </div>
                        </div>
                        <div id="sellerStylesContainer" class="border rounded p-2" style="max-height: 320px; overflow-y: auto;">
                            <!-- Styles checkboxes will be injected here -->
                        </div>
                    </div>
                    <div id="sellerStylesEmpty" class="alert alert-info mb-0" role="alert" style="display: none;">
                        No styles found for this seller yet. Run a scan first, then you can filter styles here.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-brand" onclick="saveSellerOptions()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Collection Modal -->
    <div class="modal fade" id="collectionModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">My Collection</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="collectionContent">
                        <div class="text-center py-4">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Wantlist Modal -->
    <div class="modal fade" id="wantlistModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">My Wantlist</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="wantlistContent">
                        <div class="text-center py-4">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- OAuth Login Instructions Modal -->
    <div class="modal fade" id="oauthLoginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Login with Discogs</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>To access your Collection and Wantlist, you need a <strong>Personal Access Token</strong> from Discogs.</p>
                    
                    <h6 class="mt-3">How to get your token:</h6>
                    <ol>
                        <li>Go to <a href="https://www.discogs.com/settings/developers" target="_blank">Discogs Developer Settings</a></li>
                        <li>Click <strong>"Generate new token"</strong></li>
                        <li>Copy the token that appears</li>
                        <li>Paste it below</li>
                    </ol>
                    
                    <div class="alert alert-warning mt-3">
                        <i class="bi bi-exclamation-triangle"></i> Keep this token private! It gives access to your Discogs account.
                    </div>
                    
                    <label for="userTokenInput" class="form-label mt-3">Personal Access Token</label>
                    <input type="text" class="form-control" id="userTokenInput" placeholder="Paste your token here">
                    
                    <div class="form-text">This token will be stored securely in your browser and never sent to any server except Discogs.</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-brand" onclick="loginWithToken()">Login</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-3">
        <small>
            <a href="discogs.html" style="color: inherit; text-decoration: none">
                &copy; 2025 - Discogs Seller Tracker
            </a>
            <br />
            <span style="opacity: 0.7; font-size: 0.85em;">
                This application uses Discogs' API but is not affiliated with, sponsored, or endorsed by Discogs. 
                Discogs is a registered trademark of Zink Media, LLC. 
                <a href="https://www.discogs.com" target="_blank" style="color: inherit; text-decoration: underline;">Data provided by Discogs</a>.
            </span>
            <br />
            <a
                href="imprint.html"
                style="color: inherit; text-decoration: none; opacity: 0.7"
            >
                Impressum
            </a>
            |
            <a
                href="privacy.html"
                style="color: inherit; text-decoration: none; opacity: 0.7"
            >
                DatenschutzerklÃ¤rung
            </a>
        </small>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JavaScript -->
    <script src="script.js"></script>
</body>
</html>
